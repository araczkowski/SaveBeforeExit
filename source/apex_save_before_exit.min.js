(function(a){a.widget("ui.apex_save_before_exit",{options:{saveMessage:null,noWarningSelector:null,disableTime:null,ignoreModificationsSelector:null,highlightModifiedItems:null,debug:a("#pdebug").length!==0},_createPrivateStorage:function(){var b=this;if(b.options.debug){apex.debug("Save Before Exit: _createPrivateStorage (start)")}b._values={itemModified:false,promptUser:true,forcePrompt:false};b._elements={$modifiedItems:a()};if(b.options.debug){apex.debug("Save Before Exit: _createPrivateStorage (end)")}},_create:function(){var c=this;var b;var d;if(c.options.debug){apex.debug("Save Before Exit: _create (start)");apex.debug("...Options");for(name in c.options){apex.debug("......"+name+': "'+c.options[name]+'"')}}c._createPrivateStorage();if(c.options.ignoreModificationsSelector===undefined||c.options.ignoreModificationsSelector===null){c.options.ignoreModificationsSelector=""}if(c.options.debug){b=a(c.options.ignoreModificationsSelector);if(b.length){b.each(function(){apex.debug('...Ignore modifications to: "'+this.nodeName+'"');for(name in this.attributes){if(typeof(this.attributes[name])!=="function"){apex.debug("......"+this.attributes[name].nodeName+': "'+this.attributes[name].nodeValue+'"')}}})}else{apex.debug("...No elements selected to ignore modifications to")}}if(c.options.noWarningSelector===undefined||c.options.noWarningSelector===null){c.options.noWarningSelector=""}d=a(c.options.noWarningSelector);if(c.options.debug&&!d.length){apex.debug("...No elements selected to allow leaving without warnings")}d.each(function(){var f=a(this);var e=f.prop("onclick");if(c.options.debug){apex.debug('...Disable warnings for: "'+this.nodeName+'"');for(name in this.attributes){if(typeof(this.attributes[name])!=="function"){apex.debug("......"+this.attributes[name].nodeName+': "'+this.attributes[name].nodeValue+'"')}}}if(e){f.removeAttr("onclick").prop("onclick",null).click(function(){c._disableWarningTemp();e()})}else{f.click(function(){c._disableWarningTemp()})}});window.onbeforeunload=function(){if(c._values.forcePrompt){if(a.browser.msie){c._disableWarningTemp()}return c.options.saveMessage}else{if(c._values.promptUser){if(c.options.highlightModifiedItems==="Y"){c._detectModifications(false,true,false)}else{c._detectModifications(true,false,false)}if(c._values.itemModified===false){return}if(a.browser.msie){c._disableWarningTemp()}if(c._values.itemModified){return c.options.saveMessage}}}};a("form#wwvFlowForm fieldset.shuttle").not(c.options.ignoreModificationsSelector).each(function(){var e=$v(this.id);a(this).data("apex-sbe-load-val",e)});if(c.options.debug){apex.debug("Save Before Exit: _create (end)")}},_disableWarningTemp:function(){var b=this;if(b.options.debug){apex.debug("Save Before Exit: _disableWarningTemp (start)")}b._values.promptUser=false;setTimeout(function(){b.enableWarning()},b.options.disableTime);if(b.options.debug){apex.debug("Save Before Exit: _disableWarningTemp (end)")}},_detectModifications:function(d,c,e){var b=this;if(b.options.debug){apex.debug("Save Before Exit: _detectModifications (start)")}b._values.itemModified=false;b._elements.$modifiedItems=a();if(c){a(".apex-save-before-exit-highlight").removeClass("apex-save-before-exit-highlight")}a('form#wwvFlowForm input[type="text"],form#wwvFlowForm input[type="file"],form#wwvFlowForm input[type="password"],form#wwvFlowForm input[type="hidden"]').not(b.options.ignoreModificationsSelector).each(function(){if(this.value!==this.defaultValue){b._values.itemModified=true;if(e){b._elements.$modifiedItems=b._elements.$modifiedItems.add(this)}if(c){a(this).addClass("apex-save-before-exit-highlight")}if(b.options.debug){apex.debug('...Modification detected on: "'+this.id+'"');apex.debug('......Default Value: "'+this.defaultValue+'"');apex.debug('......Current Value: "'+this.value+'"')}if(d){return false}}});if(d&&b._values.itemModified===true){return true}a('form#wwvFlowForm input[type="radio"],form#wwvFlowForm input[type="checkbox"]').not(b.options.ignoreModificationsSelector).each(function(){if(this.checked!==this.defaultChecked){b._values.itemModified=true;if(e){b._elements.$modifiedItems=b._elements.$modifiedItems.add(a(this).closest("fieldset"))}if(c){a(this).closest("fieldset").addClass("apex-save-before-exit-highlight")}if(b.options.debug){apex.debug('...Modification detected on: "'+this.id+'"');apex.debug('......Default Checked: "'+this.defaultChecked+'"');apex.debug('......Current Checked: "'+this.checked+'"')}if(d){return false}}});if(d&&b._values.itemModified===true){return true}a("form#wwvFlowForm fieldset.shuttle").not(b.options.ignoreModificationsSelector).each(function(){var g=$v(this.id);var f=a(this).data("apex-sbe-load-val");if(f===undefined){f=""}if(g!==f){b._values.itemModified=true;if(e){b._elements.$modifiedItems=b._elements.$modifiedItems.add(this)}if(c){a(this).addClass("apex-save-before-exit-highlight")}if(b.options.debug){apex.debug('...Modification detected on: "'+this.id+'"');apex.debug('......Default Value: "'+f+'"');apex.debug('......Current Value: "'+g+'"')}if(d){return false}}});if(d&&b._values.itemModified===true){return true}a("form#wwvFlowForm select:not(.shuttle_left,.shuttle_right)").not(b.options.ignoreModificationsSelector).each(function(){for(var f=0;f<this.length;f++){if(this.options[f].selected!==this.options[f].defaultSelected){b._values.itemModified=true;if(e){b._elements.$modifiedItems=b._elements.$modifiedItems.add(this)}if(c){a(this).addClass("apex-save-before-exit-highlight")}if(b.options.debug){apex.debug('...Modification detected on: "'+this.id+'" ('+this.options[f].text+")");apex.debug('......Default Selected: "'+this.options[f].defaultSelected+'"');apex.debug('......Current Selected: "'+this.options[f].selected+'"')}if(d){return false}}}});if(d&&b._values.itemModified===true){return true}a("form#wwvFlowForm textarea:not(.rich_text_editor)").not(b.options.ignoreModificationsSelector).each(function(){if(this.value!==this.defaultValue){b._values.itemModified=true;if(e){b._elements.$modifiedItems=b._elements.$modifiedItems.add(this)}if(c){a(this).addClass("apex-save-before-exit-highlight")}if(b.options.debug){apex.debug('...Modification detected on: "'+this.id+'"');apex.debug('......Default Value: "'+this.defaultValue+'"');apex.debug('......Current Value: "'+this.value+'"')}if(d){return false}}});if(d&&b._values.itemModified===true){return true}a("form#wwvFlowForm textarea.rich_text_editor").not(b.options.ignoreModificationsSelector).each(function(){try{if(CKEDITOR.instances[this.id].checkDirty()){b._values.itemModified=true;if(e){b._elements.$modifiedItems=b._elements.$modifiedItems.add(this)}if(c){a(this).closest("td").addClass("apex-save-before-exit-highlight")}if(b.options.debug){apex.debug('...Modification detected on: "'+this.id+'"');apex.debug('......Default Value: "'+this.defaultValue+'"');apex.debug('......Current Value: "'+CKEDITOR.instances[this.id].getData()+'"')}if(d){return false}}}catch(f){null}})},modificationDetected:function(){var b=this;if(b.options.debug){apex.debug("Save Before Exit: modificationDetected (start)")}b._detectModifications(true,false,false);if(b.options.debug){apex.debug("Save Before Exit: modificationDetected (end)")}return b._values.itemModified},modifiedItems:function(c){var d=this;var e={highlight:false};var b=a.extend(e,c);if(d.options.debug){apex.debug("Save Before Exit: modifiedItems (start)")}d._detectModifications(false,b.highlight,true);if(d.options.debug){apex.debug("Save Before Exit: modifiedItems (end)")}return d._elements.$modifiedItems},enableWarning:function(){var b=this;if(b.options.debug){apex.debug("Save Before Exit: enableWarning (start)")}b._values.promptUser=true;if(b.options.debug){apex.debug("Save Before Exit: enableWarning (end)")}},disableWarning:function(){var b=this;if(b.options.debug){apex.debug("Save Before Exit: disableWarning (start)")}b._values.promptUser=false;if(b.options.debug){apex.debug("Save Before Exit: disableWarning (end)")}},enableWarningForce:function(){var b=this;if(b.options.debug){apex.debug("Save Before Exit: enableWarningForce (start)")}b._values.forcePrompt=true;if(b.options.debug){apex.debug("Save Before Exit: enableWarningForce (end)")}},disableWarningForce:function(){var b=this;if(b.options.debug){apex.debug("Save Before Exit: disableWarningForce (start)")}b._values.forcePrompt=false;if(b.options.debug){apex.debug("Save Before Exit: disableWarningForce (end)")}},warningForceEnabled:function(){var b=this;if(b.options.debug){apex.debug("Save Before Exit: warningForceEnabled (start/end)")}return b._values.forcePrompt}})})(apex.jQuery);
